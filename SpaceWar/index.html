<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cosmic 2D — v2.1 (Keystone Update)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0f1c;
    --panel: rgba(12,15,28,.8);
    --panel-b: rgba(255,255,255,.12);
    --glass: rgba(16,20,34,.6);
    --text: #e5e7eb;
    --sub: #aab3c7;
    --accentA: #93c5fd;
    --accentB: #c084fc;
    --good: #34d399;
    --warn: #f59e0b;
    --bad:  #ef4444;
  }
  html, body { margin:0; height:100%; background:var(--bg); color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif; overflow:hidden; }
  #game { display:block; width:100vw; height:100vh; background:transparent; }

  /* Top HUD */
  .hud-top {
    position:fixed; top:10px; left:10px; right:10px; z-index:40;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .chip { display:flex; gap:10px; align-items:center; padding:6px 10px; border-radius:999px;
          background:var(--glass); border:1px solid var(--panel-b); backdrop-filter:blur(8px); font-size:12px; box-shadow:0 10px 24px rgba(0,0,0,.35);}
  .chip b { font-weight:800; color:#cbd5e1; }

  /* Boss bar */
  .bossbar { position:fixed; top:48px; left:50%; transform:translateX(-50%); width:min(560px, 80vw); height:10px;
             background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); border-radius:999px; overflow:hidden; z-index:39;}
  .bossbar > div { height:100%; width:0%; background:linear-gradient(90deg,#60a5fa,#f472b6); }

  /* Bottom HUD */
  .hud-bottom {
    position:fixed; bottom:10px; left:10px; right:10px; z-index:40; display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
  }
  .paddle {
    display:flex; gap:8px; padding:8px; background:var(--glass); border:1px solid var(--panel-b); border-radius:14px; backdrop-filter:blur(8px);
    box-shadow:0 12px 30px rgba(0,0,0,.35);
  }
  .pad-btn {
    display:flex; flex-direction:column; align-items:center; gap:6px; padding:8px 10px; border-radius:12px; cursor:pointer; user-select:none;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); min-width:72px; font-size:12px; font-weight:700;
  }
  .pad-btn.active { outline:2px solid #7dd3fc; box-shadow:0 0 0 4px rgba(125,211,252,.15) inset; }
  .pad-btn .sub { font-size:10px; color:var(--sub); font-weight:600; }

  .progress {
    flex:1; margin:0 10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:999px; height:12px; overflow:hidden;
  }
  .progress > div { height:100%; width:0%; background:linear-gradient(90deg,#7dd3fc,#c084fc); }

  .bars {
    display:grid; gap:6px; min-width:180px; background:var(--glass); border:1px solid var(--panel-b);
    padding:8px 10px; border-radius:14px; backdrop-filter:blur(8px);
  }
  .bar { position:relative; width:220px; max-width:48vw; height:10px; border-radius:999px; overflow:hidden; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); }
  .bar > div { position:absolute; left:0; top:0; bottom:0; width:50%; }
  .bar.shield > div { background:linear-gradient(90deg,#60a5fa,#22d3ee); }
  .bar.hull > div   { background:linear-gradient(90deg,#f59e0b,#ef4444); }
  .nums { display:flex; gap:12px; font-size:12px; color:#cbd5e1; }

  /* Menu */
  #menu { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:60; background:rgba(5,8,16,.7); backdrop-filter:blur(6px);}
  .panel { width:min(920px,92vw); padding:16px; border-radius:16px; background:var(--panel); border:1px solid var(--panel-b);
           box-shadow:0 18px 60px rgba(0,0,0,.5); }
  .modes { display:grid; grid-template-columns:repeat(auto-fit, minmax(180px,1fr)); gap:10px; }
  .mode-card { padding:12px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); cursor:pointer; }
  .mode-card.selected { outline:2px solid #a78bfa; box-shadow:0 0 0 4px rgba(167,139,250,.15) inset; }
  .start { margin-top:12px; display:flex; justify-content:flex-end; }
  .btn { padding:10px 14px; border-radius:12px; font-weight:800; border:1px solid rgba(255,255,255,.18); background:linear-gradient(90deg,#7dd3fc,#c084fc); color:#0b1020; cursor:pointer; }
  .btn:disabled { opacity:.6; cursor:not-allowed; }

  /* Level stats */
  #levelStats.hidden { display:none; }
  #levelStats { position:fixed; inset:0; z-index:70; display:flex; align-items:center; justify-content:center; background:rgba(5,8,16,.7); backdrop-filter:blur(6px);}
  .stats-card { width:min(520px,90vw); background:var(--panel); border:1px solid var(--panel-b); border-radius:16px; padding:16px; }
  .stats-card h3 { margin:0 0 10px; }
</style>
</head>
<body>
  <canvas id="game"></canvas>

  <!-- HUD: top -->
  <div class="hud-top">
    <div class="chip"><b>Mode</b><span id="uiMode"> —</span></div>
    <div class="chip"><b>Level</b><span id="uiLevel">1</span></div>
    <div class="chip"><b>Score</b><span id="uiScore">0</span></div>
    <div class="chip"><b>Enemies</b><span id="uiEnemies">0</span></div>
    <div class="chip"><b>Kills</b><span id="uiKills">0</span></div>
    <div class="chip"><b>Res</b><span id="uiRes">0</span></div>
    <div class="chip"><b>FPS</b><span id="uiFPS">—</span></div>
  </div>

  <!-- Boss bar (only fills during boss) -->
  <div class="bossbar"><div id="bossHPFill"></div></div>

  <!-- HUD: bottom -->
  <div class="hud-bottom">
    <div class="paddle">
      <div class="pad-btn" id="btnWingL"><span>Wing • L</span><div class="sub" id="lblWingL">auto</div></div>
      <div class="pad-btn" id="btnWingR"><span>Wing • R</span><div class="sub" id="lblWingR">auto</div></div>
      <div class="pad-btn" id="btnHarv"><span>Harvester</span><div class="sub" id="lblHarv">auto</div></div>
      <div class="pad-btn" id="btnOver"><span>Overdrive</span><div class="sub">simulated</div></div>
    </div>
    <div class="progress"><div id="progBar"></div></div>
    <div class="bars">
      <div style="font-weight:800;font-size:12px;opacity:.9">Status</div>
      <div class="bar shield"><div id="shieldFill" style="width:100%"></div></div>
      <div class="bar hull"><div id="hullFill" style="width:100%"></div></div>
      <div class="nums">
        <div><b>Keys</b> <span id="uiKeys">0/0</span></div>
      </div>
    </div>
  </div>

  <!-- Menu -->
  <div id="menu">
    <div class="panel">
      <h2 style="margin:0 0 10px">Cosmic 2D — v2.1 (Keystone Update)</h2>
      <div class="modes">
        <div class="mode-card" data-mode="A"><b>Mode A — Arcade</b><div style="opacity:.75;font-size:12px">Faster, spicier waves.</div></div>
        <div class="mode-card" data-mode="B"><b>Mode B — Balanced</b><div style="opacity:.75;font-size:12px">Recommended default.</div></div>
        <div class="mode-card" data-mode="C"><b>Mode C — Chill</b><div style="opacity:.75;font-size:12px">Relaxed pace.</div></div>
        <div class="mode-card perf" data-mode="D"><b>Mode D — Performance</b><div style="opacity:.75;font-size:12px">Mobile friendly.</div></div>
      </div>
      <div class="start">
        <button class="btn" id="startBtn" disabled>Start</button>
      </div>
    </div>
  </div>

  <!-- Level stats overlay -->
  <div id="levelStats" class="hidden">
    <div class="stats-card">
      <h3>Level Complete</h3>
      <div id="levelStatsBody">…</div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="render.js"></script>
  <script src="core.js"></script>

  <!-- Tiny UI glue for paddle toggles -->
  <script>
  (function(){
    const S = (window.Cosmic && window.Cosmic.state) || null;
    function setActive(el, on){ el.classList.toggle('active', !!on); }
    function cycle3(curr){ return curr==='auto' ? 'deploy' : (curr==='deploy' ? 'recall' : 'auto'); }

    const btnL = document.getElementById('btnWingL');
    const btnR = document.getElementById('btnWingR');
    const btnH = document.getElementById('btnHarv');
    const btnO = document.getElementById('btnOver');
    const lblL = document.getElementById('lblWingL');
    const lblR = document.getElementById('lblWingR');
    const lblH = document.getElementById('lblHarv');

    function sync(){
      if(!window.Cosmic || !Cosmic.state) return;
      const s = Cosmic.state;
      lblL.textContent = s.wingCtl.L; setActive(btnL, s.wingCtl.L!=='auto');
      lblR.textContent = s.wingCtl.R; setActive(btnR, s.wingCtl.R!=='auto');
      lblH.textContent = s.harvCtl;   setActive(btnH, s.harvCtl!=='auto');
    }
    btnL.addEventListener('click', ()=>{ if(!Cosmic.state) return; Cosmic.state.wingCtl.L = cycle3(Cosmic.state.wingCtl.L); sync(); });
    btnR.addEventListener('click', ()=>{ if(!Cosmic.state) return; Cosmic.state.wingCtl.R = cycle3(Cosmic.state.wingCtl.R); sync(); });
    btnH.addEventListener('click', ()=>{ if(!Cosmic.state) return; Cosmic.state.harvCtl   = cycle3(Cosmic.state.harvCtl); sync(); });
    btnO.addEventListener('click', ()=>{ /* simulated: we can add a temporary warp flash later */ });

    setInterval(sync, 250);
  })();
  </script>
</body>
</html>
